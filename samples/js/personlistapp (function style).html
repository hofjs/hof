<!DOCTYPE html>
<html>
<head>
    <title>Personlist app</title>
    <script src="../../lib/nomodule/hof.js"></script>
    <script>
        class Person {
            constructor(name, age) {
                if (typeof(name) != "undefined" && typeof(age) != "undefined")
                    this.id = Person.counter++; // Neues Objekt bekommt neue ID
                else
                    this.id = ""; // Tempor√§res Objekt bekommt keine ID

                this.name = name || "";
                this.age = age || "";
            }
        }
        Person.counter = 1;
    </script>
    <script>
        component("person-data-input", {
            value: "",
            label: "",
            change: null,

            styles() {
                return `
                    input { color: blue; }
                `;
            },

            persons: [new Person("Alex, 21"), new Person("Mike", 19), new Person("Chris", 22)],

            render() {               
                return () => `${this.label}: <input value="${this.value}" onchange="${this.change}" />`;
            }
        }, "label");
      
        component("person-data-list", {
            persons: [],
            
            edititem: null,
            deleteitem: null,
            
            render() {
                return ["persons", (person) => 
                    `<li>
                        ${person.name} - ${person.age} Jahre
                        [<a href="#" onclick="${() => this.edititem(person)}">Edit</a>]
                        [<a href="#" onclick="${() => this.deleteitem(person)}">Delete</a>]
                    </li>`];
            }
        });

        component("person-data-info", {
            value: [],

            render() {
                return () => `
                    <br/><br/>Person Info
                    <li>First Person: ${(this.value[0]?.name ?? "-") + " (" + (this.value[0]?.age ?? "") + ")"}</li>
                    <li>Last Person: ${(this.value[this.value.length-1]?.name ?? "-") + " (" + (this.value[this.value.length-1]?.age ?? "") + ")"}</li>
                `;
            }
        });

        const personStore = {
            selected: new Person(),
            persons: [new Person("Alex", 21), new Person("Chris", 19), new Person("Mike", 19)],

            changeName(value) { this.selected.name = value; },
            changeAge(event) { this.selected.age = event.target.value; },

            create() { this.selected = new Person(); },
            edit(person) { this.selected = { ...person }; },
            remove(person) { this.persons.splice(this.findIndex(person), 1); this.create(); },
            save() {
                if (this.selected.id) // Existing person?
                    this.persons.splice(this.findIndex(this.selected), 1, this.selected);
                else
                    this.persons.push(new Person(this.selected.name, this.selected.age));

                this.create();
            },
            findIndex(person) { return this.persons.findIndex(p => p.id == person.id);  },
        }

        component("person-data", {
            personStore,
            
            render() {
                return () => `
                    <fieldset>
                        <person-data-input label="Name" value="${this.personStore.selected.name}" change="${(event) => this.personStore.changeName(event.target.value)}"></person-data-input>
                        <person-data-input label="Age" value="${this.personStore.selected.age}" change="${(event) => this.personStore.changeAge(event)}"></person-data-input>
                        <button onclick="${this.personStore.save}">Speichern</button>
                    </fieldset>                    
                    
                    ${this.personStore.persons.length} persons in list
                    <person-data-list persons="${this.personStore.persons}" edititem="${this.personStore.edit}" deleteitem="${this.personStore.remove}"></person-data-list>
                    
                    <a href="#" onclick="${this.personStore.create}">Neu</a>

                    <person-data-info value="${this.personStore.persons}"></person-data-info>  
                `;
            }
        });

        // component("person-data", {
        //     selected: new Person(),
        //     persons: [new Person("Alex", 21), new Person("Chris", 19), new Person("Mike", 19)],

        //     changeName(value) { this.selected.name = value; },
        //     changeAge(event) { this.selected.age = event.target.value; },

        //     create() { this.selected = new Person(); },
        //     edit(person) { this.selected = { ...person }; }, // Copy object to avoid live update on text change
        //     remove(person) { this.persons.splice(this.findIndex(person), 1); this.create(); },
        //     save() {
        //         if (this.selected.id) // Existing person?
        //             this.persons.splice(this.findIndex(this.selected), 1, this.selected);
        //         else
        //             this.persons.push(new Person(this.selected.name, this.selected.age));

        //         this.create();
        //     },
        //     findIndex(person) { return this.persons.findIndex(p => p.id == person.id);  },
            
        //     render() {
        //         return () => `
        //             <fieldset>
        //                 <person-data-input label="Name" value="${this.selected.name}" change="${(event) => this.changeName(event.target.value)}"></person-data-input>
        //                 <person-data-input label="Age" value="${this.selected.age}" change="${(event) => this.changeAge(event)}"></person-data-input>
        //                 <button onclick="${this.save}">Speichern</button>
        //             </fieldset>                    
                    
        //             ${this.persons.length} persons in list
        //             <person-data-list persons="${this.persons}" edititem="${this.edit}" deleteitem="${this.remove}"></person-data-list>
                    
        //             <a href="#" onclick="${this.create}">Neu</a>

        //             <person-data-info value="${this.persons}"></person-data-info>  
        //         `;
        //     }
        // });
    </script>
</head>
<body>
    <h1>Personlist app (function style)</h1>
    <person-data></person-data>
</body>
</html>