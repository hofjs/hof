<!DOCTYPE html>
<html>
<head>
    <title>Personlist app (class style)</title>
    <script src="../src/hof.js"></script>
    <script>
        class Person {
            constructor(name, age) {
                if (typeof(name) != "undefined" && typeof(age) != "undefined")
                    this.id = Person.counter++; // Neues Objekt bekommt neue ID
                else
                    this.id = ""; // Tempor√§res Objekt bekommt keine ID

                this.name = name || "";
                this.age = age || "";
            }
        }
        Person.counter = 1;
    </script>
    <script>
         customElements.define('person-data-list', class extends HofHtmlElement {
            constructor() {
                super('div')
                super.useAutoProps();
            }

            persons;
            
            render() {
                super.renderList(this.persons, (person) => 
                    `<person-data-list-item person="${person}"></person-data-list-item>`)
            }
        });

        customElements.define('person-data-list-item', class extends HofHtmlElement {
            constructor() {
                super('li')
                super.useAutoProps();
            }

            person = new Person();
           
            render() {
                super.renderContent(() => `
                    ${this.person.name} - ${this.person.age} Jahre                            
                    [<a href="#" onclick="${() => this.dispatch('EDIT_PERSON', this.person)}">Edit</a>]
                    [<a href="#" onclick="${() => this.dispatch('DELETE_PERSON', this.person)}">Delete</a>]
                `)
            }
        });

        customElements.define('person-data-input', class extends HofHtmlElement {
            constructor() { super('label'); super.useAutoProps(); }
            
            value = "";
            label = "";
            action = "";

            render() {
                super.renderContent(() => `${this.label}: <input value="${this.value}" onchange="${(e) => this.dispatch(this.action, e.target.value)}" />`);
            }
        });

        customElements.define('person-data-info', class extends HofHtmlElement {
            constructor() { super('div'); super.useAutoProps(); }
            
            value = [];

            render() {
                super.renderContent(() =>`
                    <br/><br/>Person Info
                    <li>First Person: ${(this.value[0]?.name ?? "-") + " (" + (this.value[0]?.age ?? "") + ")"}</li>
                    <li>Last Person: ${(this.value[this.value.length-1]?.name ?? "-") + " (" + (this.value[this.value.length-1]?.age ?? "") + ")"}</li>
                `);
            }
        });

        customElements.define('person-data', class extends HofHtmlElement {
            constructor() { super('div'); super.useAutoProps(); }

            selectedPerson = new Person();
            persons = [new Person("Alex", 21), new Person("Chris", 19), new Person("Mike", 19)];

            changeName(value) { this.selectedPerson.name = value; }
            changeAge(value) { this.selectedPerson.age = value * 2; }

            create() { this.selectedPerson = new Person(); }
            edit(person) { this.selectedPerson = person; }
            remove(person) { this.persons.splice(this.findPersonIndex(person), 1); this.create(); }
            save() {
                if (this.selectedPerson.id) // Existierende Person?
                    this.persons.splice(this.findPersonIndex(this.selectedPerson), 1, this.selectedPerson);
                else
                    this.persons.push(new Person(this.selectedPerson.name, this.selectedPerson.age));

                this.create();
            }
            findPersonIndex(person) { return this.persons.findIndex(p => p.id == person.id);  }

            render() {
                this.callback("EDIT_PERSON", this.edit);
                this.callback("DELETE_PERSON", this.remove);
                this.callback("CHANGE_NAME", this.changeName);
                this.callback("CHANGE_AGE", this.changeAge);

                super.renderContent(() => `
                    <fieldset>
                        <person-data-input label="Name" value="${this.selectedPerson.name}" action="CHANGE_NAME"></person-data-input>
                        <person-data-input label="Age" value="${this.selectedPerson.age}" action="CHANGE_AGE"></person-data-input>
                        <button onclick="${this.save}">Speichern</button>
                    </fieldset>                    
                    
                    ${this.persons.length} Personen in der Liste
                    <person-data-list persons="${this.persons}"></person-data-list>    

                    <a href="#" onclick="${this.create}">Neu</a>

                    <person-data-info value="${this.persons}"></person-data-info>  
                `);
            }
        });
    </script>
</head>
<body>
    <h1>Personlist app (class style)</h1>
    <person-data></person-data>
</body>
</html>