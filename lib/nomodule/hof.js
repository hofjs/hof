(()=>{var p=class{constructor(e,r,t){this.execute=e;this.bindVariableNames=r;this.template=t}},h=class extends HTMLElement{constructor(e="div"){super();this._observersForBindVariable=new Map;this._observerExpressions=new Map;this._properties={};this._locals={};this._allBindVariables=null;this._allBindExpressions={};this._renderIteration=-1;this._listTemplate=null;this._listData=[];this._listIt="";this._listStart=0;this.PROPS_FILTER=e=>e.charAt(0)!="_"&&e!=e.toUpperCase()&&e!="constructor"&&e!="render";this.REFERENCED_BIND_VARIABLE_NAMES_REGEX=new RegExp("([a-zA-Z_$][\\w]+\\.[\\w\\.]+)","g");this.DERIVED_PROPERTY_SIGNATURE_REGEX=new RegExp("^function *\\(\\)");this._tagName=e,this._shadow=this.attachShadow({mode:"open"})}connectedCallback(){this._root=document.createElement(this._tagName),this._shadow.appendChild(this._root),this.render()}useAutoProps(){this._forEachPropertyOfObjectAndPrototype((e,r)=>{let t=r[e];e.startsWith("event-")&&(e=e.substring(6),delete r[e]),e=="construct"&&typeof t=="function"?t.call(this):Object.defineProperty(this,e,{get:function(){return this.getProperty(e,t)},set:function(s){let n=this.getProperty(e,t);this._callBindVariableBeforeChangedHook(this,e,s,n)&&(this.setProperty(e,s),this._callBindVariableAfterChangedHook(this,e,s,n))},enumerable:!0,configurable:!0})})}setProperty(e,r){let t=this._properties[e];(typeof t=="object"||typeof r=="object"||t!=r||r.lastActionMethod)&&(this._properties[e]=r,this._allBindVariables&&(this._allBindVariables[e]=r),this._updatePropertyObservers([e,r])),this._allBindVariables&&this._makeBindVariableObservable(e)}getProperty(e,r){var t,s;return this._allBindVariables?this._allBindVariables[e]:(s=(t=this._properties[e])!=null?t:this.getAttribute(e))!=null?s:r}_hasAlreadyRendered(){return this._root.textContent!=""}renderContent(e,r=void 0){this._renderFull(e,r)}renderList(e,r,t=void 0){let s=r.toString(),n=s.substring(s.indexOf("(")+1,s.indexOf(")"));if(typeof e!="string"){this._listData=e,this._listIt=n,this._listTemplate=r,this._listStart=this._root.childNodes.length,(typeof t=="undefined"||t==null)&&(t={});for(let i of this._listData)t[this._listIt]=i,this._renderFull(r,t)}}_calculateProperties(){let e={};this._forEachPropertyOfObjectAndPrototype((r,t)=>e[r]=t[r]),this._allBindVariables=e}_forEachPropertyOfObjectAndPrototype(e){for(let t of Object.getOwnPropertyNames(this).filter(this.PROPS_FILTER))e(t,this);let r=Object.getPrototypeOf(this);for(let t of Object.getOwnPropertyNames(r).filter(this.PROPS_FILTER))e(t,r)}_convertToTemplateExpression(e){let r=e.toString(),t=r.indexOf("`");return t>0&&(r=r.substring(t+1,r.length-1)),r}_parseHTML(e,r){let t=this._convertToTemplateExpression(e);this._allBindVariables==null&&this._calculateProperties();let s=this._allBindVariables,[n,i]=this._calculateTemplateAndBindVariableNames(t,s,r);return this._calculateBindings(n,i),[new DOMParser().parseFromString(n,"text/html").body.childNodes,s,i]}_makeBindVariableObservable(e){for(let r of this._allBindExpressions[e])this._makeBindVariableStructureObservable(e,r)}_makeBindVariableStructureObservable(e,r){let t=this._allBindVariables[e],s=r.split("."),n=t,i=e;for(let o=0;o<s.length;o++){let a=s[o];if(i+=`.${s[o]}`,typeof n=="undefined")return;typeof n=="object"&&(Array.isArray(n)?this._makeArrayObservable(n,e):this._makeObjectObservable(n,a,e,i)),n=n[s[o]]}}_callBindVariableBeforeChangedHook(e,r,t,s){let n=`${r}BeforeChanged`;if(e[n]){let i=e[n](t,s);return!(typeof i!="undefined"&&i==!1)}return!0}_callBindVariableAfterChangedHook(e,r,t,s){let n=`${r}AfterChanged`;e[n]&&e[n](t,s)}_callBindVariableBeforePropertyChangedHook(e,r,t,s,n){let i=`${r}BeforePropertyChanged`;if(e[i]){let o=e[i](t,s,n);return!(typeof o!="undefined"&&o==!1)}return!0}_callBindVariableAfterPropertyChangedHook(e,r,t,s,n){let i=`${r}AfterPropertyChanged`;e[i]&&e[i](t,s,n)}_makeObjectObservable(e,r,t,s){let n=e[r],i=this;this._registerNewObserver(e,r)&&Object.defineProperty(e,r,{get:function(){return n}.bind(i),set:function(o){let a=n;i._callBindVariableBeforeChangedHook(e,r,o,a)&&(n=o,e._observers.forEach((l,c)=>l.forEach(()=>{let d=c.getProperty(t,void 0);if(d){if(!c._callBindVariableBeforePropertyChangedHook(i,t,s,o,a))return;d.lastActionMethod="SET",d.lastActionPropertyPath=s,c.setProperty(t,d),c._callBindVariableAfterPropertyChangedHook(i,t,s,o,a),d.lastActionMethod=null,d.lastActionPropertyPath=null}})),i._callBindVariableAfterChangedHook(e,r,n,a))}.bind(i),enumerable:!0,configurable:!0})}_makeArrayObservable(e,r){this._registerNewObserver(e,r)&&(e._emit=function(t,s){return s.length==0?this.lastActionMethod="DELETE":t==null?this.lastActionMethod="ADD":s.length==1&&(this.lastActionMethod="EDIT"),this.lastActionIndex=t!=null?t:this.length-1,this._observers.forEach((n,i)=>n.forEach(o=>i.setProperty(o,this))),this.lastActionMethod=null,this.lastActionIndex=null,this},e.push=function(...t){return Array.prototype.push.call(this,...t),e._emit(null,t),e.length},e.splice=function(t,s,...n){let i=Array.prototype.splice.call(this,t,s,...n);return s<=1&&e._emit(t,n),i},e.edit=function(t,s){return this.splice(t,1,s)},e.delete=function(t){return this.splice(t,1)})}_registerNewObserver(e,r){return e._observers||(e._observers=new Map),e._observers.has(this)||e._observers.set(this,[]),e._observers.get(this).includes(r)?!1:(e._observers.get(this).push(r),!0)}_calculateBindings(e,r){for(let t of r){let s=new RegExp(`(${t})((\\.[\\w]+)+)`,"g");this._allBindExpressions[t]=[];for(let[,,n]of e.matchAll(s)){let i=n.substring(1);this._allBindExpressions[t].includes(i)||this._allBindExpressions[t].push(i)}this._makeBindVariableObservable(t)}}_renderFull(e,r){this._locals=r;let[t,s,n]=this._parseHTML(e,r),i=this._root.childNodes.length;for(;t.length>0;)this._root.appendChild(t[0]);for(let o=i;o<this._root.childNodes.length;o++)this._processElementBinding(this._root.childNodes[o],s,n)}_renderUpdate(e){if(this._listTemplate!=null){this._locals[this._listIt]=this._listData[e.lastActionIndex];let[r,t,s]=this._parseHTML(this._listTemplate,{[this._listIt]:this._listData[e.lastActionIndex]});e.lastActionMethod=="ADD"?(this._root.childNodes[e.lastActionIndex]?this._root.insertBefore(r[0],this._root.childNodes[this._listStart+e.lastActionIndex-1].nextSibling):this._root.appendChild(r[0]),this._processElementBinding(this._root.childNodes[this._listStart+e.lastActionIndex],t,s)):e.lastActionMethod=="EDIT"?(this._root.replaceChild(r[0],this._root.childNodes[this._listStart+e.lastActionIndex]),this._processElementBinding(this._root.childNodes[this._listStart+e.lastActionIndex],t,s)):e.lastActionMethod=="DELETE"&&this._root.childNodes[this._listStart+e.lastActionIndex].remove()}}_makeDerivedVariablesObservable(e,r,t){if(!this.DERIVED_PROPERTY_SIGNATURE_REGEX.test(r))return t;let s="||null";for(let[n]of r.matchAll(this.REFERENCED_BIND_VARIABLE_NAMES_REGEX))s+="||"+n;return t.replaceAll(`${e}`,`(${e}()${s})`)}_calculateTemplateAndBindVariableNames(e,r,t){this._renderIteration++;let s=Object.keys(r);if(t)for(let[i,o]of Object.entries(t)){let a=i+this._renderIteration;r[a]=o,s.push(a);let l=new RegExp(`(${i.replaceAll("$","\\$")})([^=-])`,"g");for(let[c,,d]of e.matchAll(l))e=e.replace(c,`${a}${d}`);e=this._makeDerivedVariablesObservable(a,o.toString(),e)}let n=new RegExp("(this[\\w$.]*\\.[\\w$]+)([(]?)","g");for(let[,i,o]of e.matchAll(n)){if(o=="(")continue;let a=i.indexOf(".")+1,l=new Function("return "+i).call(r).toString().replaceAll("this.",i.substring(a,i.indexOf(".",a)+1));e=this._makeDerivedVariablesObservable(i,l,e)}return[e,s]}_processElementBinding(e,r,t){if("attributes"in e&&Array.from(e.attributes).forEach(s=>{s.nodeValue.includes("${")&&this._processBindingExpression(e,r,t,s.nodeName,s.nodeValue)}),"data"in e&&e.data.includes("${")&&this._processBindingExpression(e,r,t,"data",e.data),"childNodes"in e)for(let s of Array.from(e.childNodes))this._processElementBinding(s,r,t);"_hasAlreadyRendered"in e&&!e._hasAlreadyRendered()&&e.render()}_processBindingExpression(e,r,t,s,n){let i=this._buildCallableExpression(s,n,t);this._observerExpressions.has(e)||this._observerExpressions.set(e,new Map),this._observerExpressions.get(e).set(s,i),this._registerElementAttributeAsObserverForBindVariables(e,s,r,i.bindVariableNames);let o=this._getBindVariableValues(i.bindVariableNames);e[s]=i.execute(...o)}_buildCallableExpression(e,r,t){e=="data"||r.lastIndexOf("${")>0||r.lastIndexOf("}")<r.length-1?r="`"+r+"`":r=r.replaceAll("${","").replaceAll("}","");let s=[];for(let n of t)r.includes(n)&&s.push(n);return new p(new Function(...s,"return "+r).bind(this),s,r)}_registerElementAttributeAsObserverForBindVariables(e,r,t,s){for(let n of s){this._observersForBindVariable.has(n)||this._observersForBindVariable.set(n,new Map);let i=this._observersForBindVariable.get(n);i.has(e)||i.set(e,[]),t[n].bind&&(t[n]=t[n].bind(this)),i.get(e).push(r)}}_getBindVariableValues(e){let r=[];for(let t of e)r.push(this._allBindVariables[t]);return r}_updatePropertyObservers(e){let[r,t]=e;if(this._observersForBindVariable.has(r))for(let[s,n]of this._observersForBindVariable.get(r).entries())for(let i of n){let o=this._observerExpressions.get(s).get(i),a=this._getBindVariableValues(o.bindVariableNames),l=o.execute(...a);(!t.lastActionPropertyPath||o.template&&o.template.includes(t.lastActionPropertyPath))&&(l.lastActionMethod?s instanceof h&&s._renderUpdate(l):s[i]=l)}}};function u(f,e,r="div"){let t=class extends h{constructor(){super(r);super.useAutoProps()}render(){}};t.componentName=f;for(let i of Object.keys(e))if(i=="render"){let o=e[i](),a=n(i);if(delete t.render,Array.isArray(o)){let l=[];if(o.length>0&&Array.isArray(o[0]))for(let c of o)l.push(s(c));else l.push(s(o));t.prototype.render=function(){l.forEach(c=>c(this,a))}}else t.prototype.render=function(){this.renderContent(o,a)}}else t.prototype["event-"+i]=e[i];function s(i){if(i.length==1)return function(o,a){o.renderContent(i[0],a)};if(i.length==2&&typeof i[0]=="function")return function(o){o.renderContent(i[0],i[1])};if(i.length>=2&&typeof i[1]=="function")return function(o,a){var l,c;o.renderList((l=o[i[0]])!=null?l:i[0],i[1],(c=i[2])!=null?c:a)};throw new Error("Invalid render function argument!")}function n(i){let o=e[i].toString(),a=o.indexOf("{")+1,l=o.lastIndexOf("return"),c=o.substring(a,l);c=c.replace(/\/\*[\s\S]*?\*\/|([^:]|^)\/\/.*$/gm," ");let d=[new RegExp("let[^\\w$]+([\\w$]+)[\\W]*=","g"),new RegExp("const[^\\w$]+([\\w$]+)[\\W]*=","g"),new RegExp("function[^\\w$]+([\\w$]+)\\(","g")],b=[];for(let _ of d)for(let[,g]of c.matchAll(_))b.push(g);return b.length>0?new Function(c+"return {"+b.join(",")+"}").call(e):[]}return customElements.define(f,t),t}window.HofHtmlElement=h;window.component=u;})();
