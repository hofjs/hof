(()=>{(function(){let c=Function.prototype.bind;c.toString().includes("[native code]")&&(Function.prototype.bind=function(){let e=c.apply(this,arguments);return e.toString=()=>this.toString(),e})})();(function(){String.prototype.replaceAll||(String.prototype.replaceAll=function(c,e){let t="",i,s;for(;~(s=this.indexOf(c,i));)t+=this.substring(i,s)+e,i=s+c.length;return t+this.substring(i)})})();var u=class{constructor(e,t,i){this.execute=e;this.bindVariableNames=t;this.template=i}},b=class extends HTMLElement{constructor(e="div"){super();this._properties={};this._locals={};this._allBindVariables=null;this._allBindExpressions={};this._observersForBindVariable=new Map;this._observerExpressions=new Map;this._renderIteration=-1;this._listTemplate=null;this._listData=[];this._listIt="";this._listStart=0;this.PROPS_FILTER=e=>e.charAt(0)!="_"&&e!=e.toUpperCase()&&e!="constructor"&&e!="render";this.REFERENCED_BIND_VARIABLE_NAMES_REGEX=new RegExp("([a-zA-Z_$][\\w]+\\.[\\w\\.]+)","g");this.DERIVED_PROPERTY_FUNCTION_SIGNATURE_REGEX=new RegExp(`^function[ 
]*\\(\\)`);this._tagName=e,this._shadow=this.attachShadow({mode:"open"})}connectedCallback(){if(this._root=document.createElement(this._tagName),this._shadow.appendChild(this._root),this.styles){let e=document.createElement("style");e.innerHTML=this.styles,this._shadow.appendChild(e)}this.render()}useAutoProps(){this._forEachPropertyOfObjectAndPrototype((e,t)=>{let i=t[e];e.startsWith("event-")&&(e=e.substring(6),delete t[e]),e=="construct"&&typeof i=="function"?i.call(this):e=="styles"&&typeof i=="function"?this.styles=i():Object.defineProperty(this,e,{get:function(){return this.getProperty(e,i)},set:function(s){let n=this.getProperty(e,i);this._callBindVariableBeforeChangedHook(this,e,s,n)&&this._callBindVariableBeforePropertyChangedHook(this,e,"",s,n)&&(Array.isArray(n)?this._renderUpdate(s):this.setProperty(e,s),this._callBindVariableAfterPropertyChangedHook(this,e,"",s,n),this._callBindVariableAfterChangedHook(this,e,s,n))},enumerable:!0,configurable:!0})})}setProperty(e,t){let i=this._properties[e];(typeof i=="object"||typeof t=="object"||i!=t||t.lastActionMethod)&&(t.lastActionPropertyPath||(this._properties[e]=t,this._allBindVariables&&(this._allBindVariables[e]=t),this._allBindVariables&&this._makeBindVariableObservable(e))),this._updatePropertyObservers([e,t])}getProperty(e,t){var i,s;return this._allBindVariables?this._allBindVariables[e]:(s=(i=this._properties[e])!=null?i:this.getAttribute(e))!=null?s:t}_hasAlreadyRendered(){return this._root.textContent!=""}renderContent(e,t=void 0){this._renderFull(e,t)}renderList(e,t,i=void 0){let s=t.toString(),n=s.substring(0,s.indexOf("=>")).replace("(","").replace(")","").trim();if(typeof e!="string"){this._listData=e,this._listIt=n,this._listTemplate=t,this._listStart=this._root.childNodes.length,(typeof i=="undefined"||i==null)&&(i={});for(let r of this._listData)i[this._listIt]=r,i[this._listIt]._observableUniqueName=this._listIt+"__it"+(this._renderIteration+1),this._renderFull(t,i)}}_calculateProperties(){let e={};this._forEachPropertyOfObjectAndPrototype((t,i)=>e[t]=i[t]),this._allBindVariables=e}_forEachPropertyOfObjectAndPrototype(e){for(let i of Object.getOwnPropertyNames(this).filter(this.PROPS_FILTER))e(i,this);let t=Object.getPrototypeOf(this);for(let i of Object.getOwnPropertyNames(t).filter(this.PROPS_FILTER))e(i,t)}_convertToTemplateExpression(e){let t=e.toString(),i=t.indexOf("`");return i>0&&(t=t.substring(i+1,t.length-1)),t.trim()}_parseHTML(e,t){let i=this._convertToTemplateExpression(e);this._allBindVariables==null&&this._calculateProperties();let s=this._allBindVariables,[n,r]=this._calculateTemplateAndBindVariableNames(i,s,t);return this._calculateBindings(n,r),[new DOMParser().parseFromString(n,"text/html").body.childNodes,s,r]}_makeBindVariableObservable(e){for(let t of this._allBindExpressions[e])this._makeBindVariableStructureObservable(e,t)}_makeBindVariableStructureObservable(e,t){let i=this._allBindVariables[e],s=t.split("."),n=i,r=e;for(let o=0;o<s.length;o++){let a=s[o];if(r+=`.${s[o]}`,typeof n=="undefined")return;if(typeof n=="object"){if(!Array.isArray(n)&&r.includes(".")&&n[a].bind&&(n[a]=n[a].bind(n)),n[a].bind)continue;Array.isArray(n)?this._makeArrayObservable(n,a,e,r):this._makeObjectObservable(n,a,e,r)}n=n[s[o]]}}_callBindVariableBeforeChangedHook(e,t,i,s){let n=`${t}BeforeChanged`;if(e[n]){let r=e[n](i,s);return!(typeof r!="undefined"&&r==!1)}return!0}_callBindVariableAfterChangedHook(e,t,i,s){let n=`${t}AfterChanged`;e[n]&&e[n](i,s)}_callBindVariableBeforePropertyChangedHook(e,t,i,s,n){let r=`${t}BeforePropertyChanged`;if(e[r]){let o=e[r](i,s,n);return!(typeof o!="undefined"&&o==!1)}return!0}_callBindVariableAfterPropertyChangedHook(e,t,i,s,n){let r=`${t}AfterPropertyChanged`;e[r]&&e[r](i,s,n)}_makeObjectObservable(e,t,i,s){let n=e[t],r=this;this._registerNewObserver(e,t,this,i,s)||(Object.defineProperty(e,t,{get:function(){return n}.bind(this),set:function(o){let a=o,l=e[t];r._applyValueAndNotifyObservers(e,t,i,a,l,!1,()=>n=o)}.bind(this),enumerable:!0,configurable:!0}),s.includes(".")&&e[t].bind&&(e[t]=e[t].bind(e)))}_makeArrayObservable(e,t,i,s){let n=this;this._registerNewObserver(e,t,this,i,s)||(e._emit=function(r,o,a,l){o.length==0?this.lastActionMethod="DELETE":r==null?this.lastActionMethod="ADD":o.length==1&&(this.lastActionMethod="EDIT"),this.lastActionIndex=r!=null?r:this.length;let d=o[o.length-1],f=a[a.length-1];return this.lastActionObject=d!=null?d:f,n._applyValueAndNotifyObservers(this,t,i,d,f,!0,l),this.lastActionMethod=null,this.lastActionIndex=null,this.lastActionObject=null,this.lastActionPropertyPath=null,this},e.push=function(...r){return e._emit(null,r,[],()=>Array.prototype.push.call(this,...r)),e.length},e.splice=function(r,o,...a){let l=this.slice(r,r+o);return o<=1&&e._emit(r,a,l,()=>Array.prototype.splice.call(this,r,o,...a)),l},e.edit=function(r,o){return this.splice(r,1,o)},e.delete=function(r){return this.splice(r,1)})}_applyValueAndNotifyObservers(e,t,i,s,n,r,o){let a=this;!a._callBindVariableBeforeChangedHook(a,i,a[i],a[i])||!a._callBindVariableBeforePropertyChangedHook(a,i,t,s,n)||(o(),e._observers.get(t).forEach((l,d)=>{l.forEach((f,h)=>{f.forEach(g=>{r&&(g=g.replace(".length",""));let p=d.getProperty(h,void 0);if(p){if(r||(p.lastActionMethod="SET"),!d._callBindVariableBeforeChangedHook(d,h,d[h],d[h])||!d._callBindVariableBeforePropertyChangedHook(d,h,g,s,n))return;p.lastActionPropertyPath=g,d.setProperty(h,p),d._callBindVariableAfterPropertyChangedHook(a,h,g,s,n),p.lastActionMethod=null,p.lastActionPropertyPath=null}})})}),a._callBindVariableAfterChangedHook(a,i,a[i],a[i]))}_registerNewObserver(e,t,i,s,n){let r=!0;e._observers||(e._observers=new Map),e._observers.has(t)||(e._observers.set(t,new Map),r=!1),e._observers.get(t).has(i)||e._observers.get(t).set(i,new Map),e._observers.get(t).get(i).has(s)||e._observers.get(t).get(i).set(s,[]);let o=e._observers.get(t).get(i).get(s);return o.includes(n)||o.push(n),r}_calculateBindings(e,t){for(let i of t){let s=new RegExp(`(${i})((\\.[\\w]+)+)`,"g");this._allBindExpressions[i]=[];for(let[,,n]of e.matchAll(s)){let r=n.substring(1);this._allBindExpressions[i].includes(r)||this._allBindExpressions[i].push(r)}this._makeBindVariableObservable(i)}}_renderFull(e,t){this._locals=t;let[i,s,n]=this._parseHTML(e,t),r=this._root.childNodes.length;for(;i.length>0;)this._root.appendChild(i[0]);for(let o=r;o<this._root.childNodes.length;o++)this._processElementBinding(this._root.childNodes[o],s,n)}_removeObserversForBindVariable(e){if(this._observersForBindVariable.has(e))for(let[t]of this._observersForBindVariable.get(e)){for(let[i,s]of this._observerExpressions.get(t))s.bindVariableNames.includes(e)&&this._observerExpressions.get(t).delete(i);this._observerExpressions.get(t).size==0&&this._observerExpressions.delete(t)}this._observersForBindVariable.delete(e),delete this._allBindVariables[e],delete this._allBindExpressions[e]}_renderUpdate(e){if(this._listTemplate!=null)if(this._locals[this._listIt]=this._listData[e.lastActionIndex],e.lastActionMethod=="DELETE")this._removeObserversForBindVariable(e.lastActionObject._observableUniqueName),this._root.childNodes[this._listStart+e.lastActionIndex].remove();else{this._locals[this._listIt]._observableUniqueName=this._listIt+"__it"+(this._renderIteration+1);let[t,i,s]=this._parseHTML(this._listTemplate,this._locals);e.lastActionMethod=="ADD"?(this._root.childNodes[e.lastActionIndex]?this._root.insertBefore(t[0],this._root.childNodes[this._listStart+e.lastActionIndex-1].nextSibling):this._root.appendChild(t[0]),this._processElementBinding(this._root.childNodes[this._listStart+e.lastActionIndex],i,s)):e.lastActionMethod=="EDIT"&&(this._root.replaceChild(t[0],this._root.childNodes[this._listStart+e.lastActionIndex]),this._processElementBinding(this._root.childNodes[this._listStart+e.lastActionIndex],i,s))}}_logUpdate(e,t,i){var s,n,r;i.bind||i.lastActionPropertyPath||console.log(`[${(s=e.nodeName)!=null?s:"TEXT"}]: Update of ${t}: ${(n=i.lastActionMethod)!=null?n:"SET"} ${JSON.stringify((r=i.lastActionObject)!=null?r:i)}`)}_makeDerivedVariablesObservable(e,t,i){if(!this.DERIVED_PROPERTY_FUNCTION_SIGNATURE_REGEX.test(t))return i;let s="||null";for(let[n]of t.matchAll(this.REFERENCED_BIND_VARIABLE_NAMES_REGEX))s+="||"+n;return i.replace(new RegExp(`([^\\w])${e}\\(\\)([^\\w])`,"g"),`$1(${e}()${s})$2`)}_calculateUniqueElementAndVariableName(e,t){return e+"__it"+t}_calculateTemplateAndBindVariableNames(e,t,i){this._renderIteration++;let s=Object.keys(t);if(i)for(let[r,o]of Object.entries(i)){let a=r+"__it"+this._renderIteration;t[a]=o,s.push(a),e=e.replace(new RegExp(`([{][^{}]*[^\\w]?)${r}([^\\w])`,"g"),`$1${a}$2`),e=this._makeDerivedVariablesObservable(a,o.toString(),e)}let n=new RegExp("(this[\\w$.]*\\.[\\w$]+)([(]?)","g");for(let[,r]of e.matchAll(n)){let o=r.indexOf(".")+1,a=new Function("return "+r).call(t);if(!a)continue;let l=a.toString().replaceAll("this.",r.substring(o,r.indexOf(".",o)+1));e=this._makeDerivedVariablesObservable(r,l,e)}return[e,s]}_processElementBinding(e,t,i){if("attributes"in e&&Array.from(e.attributes).forEach(s=>{s.nodeValue.includes("${")&&this._processBindingExpression(e,t,i,s.nodeName,s.nodeValue)}),"data"in e&&e.data.includes("${")&&this._processBindingExpression(e,t,i,"data",e.data),"childNodes"in e)for(let s of Array.from(e.childNodes))this._processElementBinding(s,t,i);"_hasAlreadyRendered"in e&&!e._hasAlreadyRendered()&&e.render()}_processBindingExpression(e,t,i,s,n){let r=this._buildCallableExpression(s,n,i);this._observerExpressions.has(e)||this._observerExpressions.set(e,new Map),this._observerExpressions.get(e).set(s,r);for(let l of r.bindVariableNames)t[l].bind&&(t[l]=t[l].bind(this));let o=this._getBindVariableValues(r.bindVariableNames),a=r.execute(...o);e[s]=a,a!=null&&!a.bind&&this._registerElementAttributeAsObserverForBindVariables(e,s,t,r.bindVariableNames)}_buildCallableExpression(e,t,i){e=="data"||t.lastIndexOf("${")>0||t.lastIndexOf("}")<t.length-1?t="`"+t+"`":t=t.replaceAll("${","").replaceAll("}","");let s=[];for(let n of i)t.includes(n)&&s.push(n);return new u(new Function(...s,"try {return "+t+"} catch(e) { return ''; }").bind(this),s,t)}_registerElementAttributeAsObserverForBindVariables(e,t,i,s){for(let n of s){this._observersForBindVariable.has(n)||this._observersForBindVariable.set(n,new Map);let r=this._observersForBindVariable.get(n);r.has(e)||r.set(e,[]),i[n].bind&&(i[n]=i[n].bind(this)),r.get(e).push(t)}}_getBindVariableValues(e){let t=[];for(let i of e)t.push(this._allBindVariables[i]);return t}_updatePropertyObservers(e){let[t,i]=e;if(this._observersForBindVariable.has(t))for(let[s,n]of this._observersForBindVariable.get(t).entries())for(let r of n){let o=this._observerExpressions.get(s).get(r);if(!i.lastActionPropertyPath||o.template.includes(i.lastActionPropertyPath)){let a=this._getBindVariableValues(o.bindVariableNames),l=o.execute(...a);(typeof l.lastActionIndex!="undefined"||!i.lastActionPropertyPath||o.template&&o.template.includes(i.lastActionPropertyPath))&&(s instanceof b||s[r]!=l)&&(s[r]=l)}}}};function _(c,e,t="div"){let i=class extends b{constructor(){super(t);super.useAutoProps()}render(){}};i.componentName=c;for(let r of Object.keys(e))if(r=="render"){let o=e[r](),a=n(r);if(delete i.render,Array.isArray(o)){let l=[];if(o.length>0&&Array.isArray(o[0]))for(let d of o)l.push(s(d));else l.push(s(o));i.prototype.render=function(){l.forEach(d=>d(this,a))}}else i.prototype.render=function(){this.renderContent(o,a)}}else i.prototype["event-"+r]=e[r];function s(r){if(r.length==1)return function(o,a){o.renderContent(r[0],a)};if(r.length==2&&typeof r[0]=="function")return function(o){o.renderContent(r[0],r[1])};if(r.length>=2&&typeof r[1]=="function")return function(o,a){var l,d;o.renderList((l=o[r[0]])!=null?l:r[0],r[1],(d=r[2])!=null?d:a)};throw new Error("Invalid render function argument!")}function n(r){let o=e[r].toString();o=o.replace(/\/\*[\s\S]*?\*\/|([^:]|^)\/\/.*$/gm," ");let a=o.indexOf("{")+1,l=o.lastIndexOf("return"),d=o.substring(a,l);d=d.replace(/[ \n]+=[ \n]+\(([^\)]*)\)[ \n]*=>[ \n]*({[ \n]*return)?([^;]+;[ \n]*)}?/gm,"= function($1) { return $3 }; ");let f=[];for(let[,,h]of d.matchAll(/(const|let|function)[ \n]+([^ \n(=]+)/gm))f.push(h);return f.length>0?new Function(d+"return {"+f.join(",")+"}").call(e):[]}return customElements.define(c,i),i}window.HofHtmlElement=b;window.component=_;})();
